extends CharacterBody2D

@export var speed: float = 100.0
@export var attack_range: float = 40.0
@export var attack_cooldown: float = 1.5

@onready var animation: AnimatedSprite2D = $AnimatedSprite2D
@onready var detection_area: Area2D = $DetectionArea
@onready var attack_timer: Timer = $AttackTimer

var player: Node2D = null

func _ready() -> void:
    detection_area.body_entered.connect(_on_body_entered)
    detection_area.body_exited.connect(_on_body_exited)

func _physics_process(delta: float) -> void:
    if player:
        var distance = global_position.distance_to(player.global_position)

        if distance > attack_range:
            _chase_player(delta)
        else:
            _attack_player()

func _chase_player(delta: float) -> void:
    var direction = (player.global_position - global_position).normalized()
    velocity = direction * speed
    move_and_slide()
    animation.play("walk")

func _attack_player() -> void:
    velocity = Vector2.ZERO
    move_and_slide()

    if not attack_timer.is_running():
        animation.play("attack")
        attack_timer.start()
        # Optional: apply damage to player here

func _on_body_entered(body: Node2D) -> void:
    if body.name == "Player":
        player = body
func _on_body_exited(body: Node2D) -> void:
	if body == player:
		player = null
	move_and_slide()
